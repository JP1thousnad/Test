# ğŸ¤– Earnings Analysis Bot

A comprehensive Python bot for analyzing stock earnings, transcribing earnings calls, and generating investment insights. Built with patterns used by major financial tech platforms.

## ğŸ“‹ Features

| Feature | Description |
|---------|-------------|
| **Financial Data Fetching** | Pull income statements, balance sheets, cash flow from multiple sources |
| **Metrics Calculation** | Auto-calculate margins, ratios, growth rates, beat/miss analysis |
| **Earnings Call Transcription** | Convert audio to text using OpenAI Whisper |
| **NLP Analysis** | Sentiment analysis, keyword extraction, management tone detection |
| **Report Generation** | Export to JSON, Markdown, or structured formats |
| **REST API** | Full FastAPI service with async support |
| **Data Pipelines** | Airflow-style DAG orchestration for scheduled tasks |
| **Peer Comparison** | Compare metrics across competitor stocks |

## ğŸ—ï¸ Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     EARNINGS ANALYSIS BOT                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚ Data Fetcher â”‚â”€â”€â”€â–¶â”‚  Calculator  â”‚â”€â”€â”€â–¶â”‚   Analyzer   â”‚      â”‚
â”‚  â”‚  (yfinance)  â”‚    â”‚  (Metrics)   â”‚    â”‚    (NLP)     â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚         â”‚                   â”‚                   â”‚               â”‚
â”‚         â–¼                   â–¼                   â–¼               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚                    EarningsBot                       â”‚       â”‚
â”‚  â”‚  â€¢ analyze_earnings()                                â”‚       â”‚
â”‚  â”‚  â€¢ compare_to_peers()                                â”‚       â”‚
â”‚  â”‚  â€¢ generate_report_json/markdown()                   â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚         â”‚                                                       â”‚
â”‚         â–¼                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚   REST API   â”‚    â”‚   Pipeline   â”‚    â”‚  Data Store  â”‚      â”‚
â”‚  â”‚  (FastAPI)   â”‚    â”‚    (DAGs)    â”‚    â”‚  (SQLite)    â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸš€ Quick Start

### Installation

```bash
# Clone or download the project
cd earnings_bot

# Install dependencies
pip install -r requirements.txt

# (Optional) Set up API keys
export OPENAI_API_KEY="your-key"  # For NLP features
export FMP_API_KEY="your-key"     # For enhanced data
```

### Basic Usage

```python
from earnings_bot import EarningsBot, quick_analyze

# Quick analysis
result = quick_analyze("AAPL")
print(f"EPS: ${result['metrics']['eps']}")
print(f"Net Margin: {result['metrics']['net_margin']}%")

# Full analysis
bot = EarningsBot()
report = bot.analyze_earnings("MSFT")
print(report.summary)
print(report.key_highlights)

# Generate reports
print(bot.generate_report_markdown(report))
```

### Run the API

```bash
# Start the server
uvicorn api_service:app --reload --port 8000

# Access docs
open http://localhost:8000/docs
```

### API Examples

```bash
# Analyze a stock
curl http://localhost:8000/analyze/AAPL

# Get metrics only
curl http://localhost:8000/metrics/NVDA

# Compare to peers
curl -X POST http://localhost:8000/compare \
  -H "Content-Type: application/json" \
  -d '{"ticker": "AAPL", "peers": ["MSFT", "GOOGL"]}'

# Batch analysis
curl -X POST http://localhost:8000/batch \
  -H "Content-Type: application/json" \
  -d '{"tickers": ["AAPL", "MSFT", "GOOGL", "AMZN"]}'
```

## ğŸ“ Project Structure

```
earnings_bot/
â”œâ”€â”€ earnings_bot.py      # Core bot logic and analysis
â”œâ”€â”€ api_service.py       # FastAPI REST endpoints
â”œâ”€â”€ data_pipeline.py     # DAG-based data pipelines
â”œâ”€â”€ nlp_module.py        # NLP and transcript analysis
â”œâ”€â”€ example_usage.py     # Demo and examples
â”œâ”€â”€ requirements.txt     # Dependencies
â””â”€â”€ README.md           # This file
```

## ğŸ“Š Core Metrics Analyzed

### Income Statement
- Revenue / Net Income / EPS
- Gross / Operating / Net Margins
- YoY and QoQ Growth Rates

### Valuation
- P/E, Forward P/E, PEG Ratio
- P/S, P/B, EV/EBITDA
- Market Cap, Enterprise Value

### Beat/Miss Analysis
- EPS vs Consensus
- Revenue vs Estimates
- Surprise Percentage

### NLP Analysis
- Sentiment Score (-1 to +1)
- Management Tone (Bullish/Bearish/Neutral)
- Key Phrases Extraction
- Risk Factor Detection
- Guidance Extraction

## ğŸ”Œ Data Sources

| Source | Type | API Key Required |
|--------|------|------------------|
| Yahoo Finance (yfinance) | Primary | No |
| Financial Modeling Prep | Enhanced | Yes |
| Alpha Vantage | Alternative | Yes |
| SEC EDGAR | Official Filings | No |
| OpenAI Whisper | Transcription | Yes |
| OpenAI GPT | NLP Analysis | Yes |

## ğŸ› ï¸ Configuration

### Environment Variables

```bash
# Required for basic functionality: None!
# yfinance works without API keys

# Optional - Enhanced NLP
OPENAI_API_KEY=sk-...

# Optional - Enhanced financial data
FMP_API_KEY=...
ALPHA_VANTAGE_KEY=...
```

### Bot Configuration

```python
from earnings_bot import EarningsBot

# With API keys
bot = EarningsBot(api_keys={
    'OPENAI_API_KEY': 'sk-...',
    'FMP_API_KEY': '...',
})

# Or from environment
bot = EarningsBot()  # Reads from env vars
```

## ğŸ“¡ API Reference

### Endpoints

| Method | Endpoint | Description |
|--------|----------|-------------|
| GET | `/health` | Health check |
| POST | `/analyze` | Full analysis with options |
| GET | `/analyze/{ticker}` | Quick analysis |
| GET | `/metrics/{ticker}` | Metrics only |
| POST | `/compare` | Peer comparison |
| POST | `/batch` | Multiple tickers |
| GET | `/stock/{ticker}/info` | Stock info |
| GET | `/stock/{ticker}/financials` | Financial statements |
| GET | `/stock/{ticker}/earnings-history` | Historical earnings |
| GET | `/stock/{ticker}/estimates` | Analyst estimates |
| POST | `/transcript/analyze` | Analyze transcript text |

### Request/Response Examples

```json
// POST /analyze
{
  "ticker": "AAPL",
  "include_transcript": false
}

// Response
{
  "success": true,
  "data": {
    "ticker": "AAPL",
    "company_name": "Apple Inc.",
    "metrics": {
      "revenue": 94930000000,
      "eps": 1.53,
      "net_margin": 25.3
    },
    "key_highlights": [
      "âœ“ EPS beat analyst estimates",
      "ğŸ“ˆ Strong revenue growth: 8.1% YoY"
    ]
  }
}
```

## ğŸ”„ Data Pipeline

Run scheduled data collection:

```python
from data_pipeline import create_daily_pipeline, Scheduler

# Create pipeline
watchlist = ["AAPL", "MSFT", "GOOGL", "AMZN", "NVDA"]
pipeline = create_daily_pipeline(watchlist)

# Run manually
scheduler = Scheduler()
scheduler.register_pipeline(pipeline)
result = scheduler.run_pipeline(pipeline.dag_id)

print(f"Status: {result.status}")
```

## ğŸ§  NLP Analysis

```python
from nlp_module import NLPProcessor, NLPBackend

# Local analysis (no API key needed)
processor = NLPProcessor(backend=NLPBackend.LOCAL)
results = processor.full_analysis(transcript_text)

print(f"Sentiment: {results['sentiment']['label']}")
print(f"Keywords: {results['keyword_analysis']}")

# With OpenAI (enhanced analysis)
processor = NLPProcessor(
    backend=NLPBackend.OPENAI,
    api_key="sk-..."
)
results = processor.full_analysis(transcript_text)
print(results['llm_analysis']['summary'])
```

## ğŸ¢ Production Deployment

### Docker

```dockerfile
FROM python:3.11-slim
WORKDIR /app
COPY . .
RUN pip install -r requirements.txt
EXPOSE 8000
CMD ["uvicorn", "api_service:app", "--host", "0.0.0.0", "--port", "8000"]
```

### Scaling Considerations

| Component | Development | Production |
|-----------|-------------|------------|
| Database | SQLite | PostgreSQL / MongoDB |
| Cache | In-memory | Redis |
| Queue | Sync | Celery / RabbitMQ |
| Pipeline | Manual | Airflow / Prefect |
| API | Single process | Kubernetes |

## ğŸ“ˆ Example Output

```
Apple Inc. (AAPL)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Revenue: $94.93B (up 8.1% YoY)
EPS: $1.53 (beat estimates by 4.2%)
Net Margin: 25.3%

Key Highlights:
  âœ“ EPS beat analyst estimates
  âœ“ Revenue beat analyst estimates
  ğŸ“ˆ Strong revenue growth: 8.1% YoY
  ğŸ’° High profitability: 25.3% net margin
  ğŸ“Š Management tone: Bullish
```

## ğŸ¤ Contributing

Contributions welcome! Areas for improvement:
- Additional data sources
- More NLP models
- Backtesting capabilities
- Real-time alerts
- Dashboard UI

## ğŸ“„ License

MIT License - Use freely for personal or commercial projects.

## âš ï¸ Disclaimer

This tool is for informational purposes only. Not financial advice. Always do your own research and consult with financial professionals before making investment decisions.
